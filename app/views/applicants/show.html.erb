<%=render 'paginate'%>
<div class="container">
    <div class="row">
        <h2 class="text-center mt-4"><%= @applicant.name %>'s Profile</h2>
        <div class="col-4 text-center mt-4">
            <%= gravatar_for @applicant, size:200%>
        </div> 
        <div class="col-8 text-center">
            <div class="row justify-content-md-center ">
                <div class="col-11 mt-4">
                    <div class="card text-center shadow mb-5 bg-white rounded">
                        <div class="card-header ">
                            <h5 class="card-title text-italics">Jobs matched : <%= @applicant.posts.count%> </h5>
                        </div>
                        <div class="card-body">
                            <h6> email    : <%= @applicant.email%></h6>
                            <hr>
                            <% if @applicant.skills.any? %>
                                &bull;
                                <% s=  Skill.where(id: @applicant.skills) %>
                                <% s.each do |skill| %>
                                    <%=skill.name %> &bull;
                                <%end%>
                            <%end%>
                            <% if logged2_in? && (@applicant == current_user2 )%>
                                <hr>
                                <%= link_to 'Edit Profile', edit_applicant_path(@applicant), {:class=>"btn btn-outline-info"}%>
                                <%= button_to 'Delete Profile', applicant_path(@applicant), method: "delete", data: { confirm: 'Are you sure?'} , class: "btn btn-outline-danger" %>
                            <%end%>
                        </div> 
                        <div class="card-footer text-muted">
                            <small> Account created <%=time_ago_in_words(@applicant.created_at)%> ago, Edited <%=time_ago_in_words(@applicant.updated_at)%> </small>
                        </div>
                    </div>
                </div>
            </div>
               
        </div>       
    </div>
</div>


<h3 class="text-center mt-4"> Jobs Matched : <%= @applicant.posts.count%> </h3>
<div class="container p-3">
    
    <table class="table table-bordered border-primary table-hover">
        <thead class="table-dark"> 
            <tr>
            <th scope="col"> Company </th>
            <th scope="col"> Post </th>
            <th scope="col"> Description </th>
            <th scope="col"> Skills Required </th>
            <th scope="col"> Percentage Matched </th>
            <th scope="col"> Actions </th>
            </tr>
        </thead>
        <% @applicant.posts.each do |post| %>
                <tr>
                    <td > <%= Company.find(post.company_id).name %> </td> 
                    <td> <%= post.name %>  </td>
                    <td > <%= truncate(post.description, length: 15)%>...</td >
                    <td >
                        <% if post.skills.any? %>
                            &bull;
                            <% s=  Skill.where(id: post.skills) %>
                            <% s.each do |skill| %>
                                <%=skill.name %> &bull;
                            <%end%>
                        <% else %>
                            <strong>No skills Mentioned </strong>
                        <% end %>
                    </td>
                    <td>
                         <div class="progress">
                            <% @count= Result.where( post_id: post, applicant_id: @applicant).first %>
                            <% @req= post.skills.count %>
                            <% @req= @req-1 %>
                            <div class="progress-bar" role="progressbar" style="width: <%= (@count.matches * 100)/(@req) %>%;" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100"><%= (@count.matches * 100)/(@req) %>%</div>
                        </div>
                        <div class="text-center"><%= @count.matches %> out of <%= @req %> matched</div>
                     </td>
                    <td> 
                        <%= link_to 'Show Post', post_path(post), {:class=>"btn btn-success btn-sm"} %>
                        <% if logged_in? && ( session[:user2_id] == current_user2 ) %>
                            <button class="btn btn-primary btn-sm"> Message </button>
                        <%end%>
                    </td>
                </tr>
            <% end %>
        </tbody>
        </table>
</div>